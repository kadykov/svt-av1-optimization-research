{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Analysis Metadata",
  "description": "Quality metrics analysis results for an encoding study. Contains VMAF, PSNR, SSIM scores and derived efficiency metrics.",
  "type": "object",
  "required": ["study_name", "analysis_date", "metrics_calculated", "vmaf_model", "clips_analyzed", "encodings"],
  "properties": {
    "study_name": {
      "type": "string",
      "description": "Name of the study being analyzed"
    },
    "analysis_date": {
      "type": "string",
      "description": "ISO 8601 timestamp when analysis was performed",
      "format": "date-time"
    },
    "metrics_calculated": {
      "type": "array",
      "description": "List of metrics that were calculated",
      "items": {
        "type": "string",
        "enum": ["vmaf", "vmaf_neg", "psnr", "ssim"]
      },
      "minItems": 1
    },
    "vmaf_model": {
      "type": "string",
      "description": "VMAF model version used (e.g., 'vmaf_v0.6.1', 'vmaf_v0.6.1neg')"
    },
    "clips_analyzed": {
      "type": "integer",
      "description": "Number of unique source clips analyzed",
      "minimum": 0
    },
    "total_encodings_analyzed": {
      "type": "integer",
      "description": "Total number of encodings analyzed",
      "minimum": 0
    },
    "encodings": {
      "type": "array",
      "description": "Analysis results for each encoding",
      "items": {
        "type": "object",
        "required": ["output_file", "source_clip", "parameters", "metrics", "file_size_bytes", "bitrate_kbps"],
        "properties": {
          "output_file": {
            "type": "string",
            "description": "Filename of encoded output"
          },
          "source_clip": {
            "type": "string",
            "description": "Source clip filename"
          },
          "parameters": {
            "type": "object",
            "description": "Encoding parameters used",
            "required": ["preset", "crf"],
            "properties": {
              "preset": {
                "type": "integer"
              },
              "crf": {
                "type": "integer"
              },
              "film_grain": {
                "type": ["integer", "null"]
              },
              "film_grain_denoise": {
                "type": ["integer", "null"]
              },
              "scm": {
                "type": ["integer", "null"]
              },
              "tune": {
                "type": ["integer", "null"]
              },
              "tile_rows": {
                "type": ["integer", "null"]
              },
              "tile_columns": {
                "type": ["integer", "null"]
              },
              "enable_qm": {
                "type": ["integer", "null"]
              }
            }
          },
          "metrics": {
            "type": "object",
            "description": "Quality metrics for this encoding",
            "properties": {
              "vmaf": {
                "type": ["object", "null"],
                "description": "VMAF scores (if calculated)",
                "properties": {
                  "mean": {
                    "type": "number",
                    "description": "Arithmetic mean VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "harmonic_mean": {
                    "type": "number",
                    "description": "Harmonic mean VMAF score (better for worst-case quality)",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "min": {
                    "type": "number",
                    "description": "Minimum VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "max": {
                    "type": "number",
                    "description": "Maximum VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_1": {
                    "type": "number",
                    "description": "1st percentile VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_5": {
                    "type": "number",
                    "description": "5th percentile VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_25": {
                    "type": "number",
                    "description": "25th percentile (Q1) VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_50": {
                    "type": "number",
                    "description": "50th percentile (median) VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_75": {
                    "type": "number",
                    "description": "75th percentile (Q3) VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "percentile_95": {
                    "type": "number",
                    "description": "95th percentile VMAF score",
                    "minimum": 0,
                    "maximum": 100
                  },
                  "std_dev": {
                    "type": "number",
                    "description": "Standard deviation of VMAF scores",
                    "minimum": 0
                  }
                }
              },
              "psnr": {
                "type": ["object", "null"],
                "description": "PSNR scores (if calculated)",
                "properties": {
                  "y_mean": {
                    "type": "number",
                    "description": "Mean PSNR for Y (luma) channel",
                    "minimum": 0
                  },
                  "u_mean": {
                    "type": "number",
                    "description": "Mean PSNR for U (chroma) channel",
                    "minimum": 0
                  },
                  "v_mean": {
                    "type": "number",
                    "description": "Mean PSNR for V (chroma) channel",
                    "minimum": 0
                  },
                  "avg_mean": {
                    "type": "number",
                    "description": "Mean PSNR averaged across all channels",
                    "minimum": 0
                  }
                }
              },
              "ssim": {
                "type": ["object", "null"],
                "description": "SSIM scores (if calculated)",
                "properties": {
                  "y_mean": {
                    "type": "number",
                    "description": "Mean SSIM for Y (luma) channel",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "u_mean": {
                    "type": "number",
                    "description": "Mean SSIM for U (chroma) channel",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "v_mean": {
                    "type": "number",
                    "description": "Mean SSIM for V (chroma) channel",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "avg_mean": {
                    "type": "number",
                    "description": "Mean SSIM averaged across all channels",
                    "minimum": 0,
                    "maximum": 1
                  }
                }
              }
            }
          },
          "file_size_bytes": {
            "type": "integer",
            "description": "Encoded file size in bytes",
            "minimum": 0
          },
          "bitrate_kbps": {
            "type": "number",
            "description": "Average bitrate in kbps",
            "minimum": 0
          },
          "duration_seconds": {
            "type": ["number", "null"],
            "description": "Video duration in seconds",
            "minimum": 0
          },
          "encoding_time_seconds": {
            "type": ["number", "null"],
            "description": "Time taken to encode (from encoding_metadata.json)",
            "minimum": 0
          },
          "encoding_fps": {
            "type": ["number", "null"],
            "description": "Encoding speed in frames per second",
            "minimum": 0
          },
          "efficiency_metrics": {
            "type": ["object", "null"],
            "description": "Derived efficiency metrics",
            "properties": {
              "vmaf_per_mbyte": {
                "type": "number",
                "description": "VMAF mean score per megabyte of output"
              },
              "vmaf_per_kbps": {
                "type": "number",
                "description": "VMAF mean score per kbps of bitrate"
              },
              "bitrate_reduction_percent": {
                "type": "number",
                "description": "Bitrate reduction vs uncompressed (estimated)"
              },
              "quality_per_encoding_second": {
                "type": "number",
                "description": "VMAF mean score per second of encoding time"
              }
            }
          },
          "analysis_time_seconds": {
            "type": ["number", "null"],
            "description": "Time taken to analyze this encoding",
            "minimum": 0
          },
          "success": {
            "type": "boolean",
            "description": "Whether analysis completed successfully"
          },
          "error": {
            "type": ["string", "null"],
            "description": "Error message if analysis failed"
          }
        }
      }
    },
    "summary": {
      "type": ["object", "null"],
      "description": "Summary statistics across all encodings",
      "properties": {
        "vmaf_range": {
          "type": "object",
          "properties": {
            "min_mean": {
              "type": "number",
              "description": "Lowest mean VMAF across all encodings"
            },
            "max_mean": {
              "type": "number",
              "description": "Highest mean VMAF across all encodings"
            }
          }
        },
        "bitrate_range_kbps": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number"
            },
            "max": {
              "type": "number"
            }
          }
        },
        "best_efficiency": {
          "type": ["object", "null"],
          "description": "Encoding with best VMAF per kbps ratio",
          "properties": {
            "output_file": {
              "type": "string"
            },
            "parameters": {
              "type": "object"
            },
            "vmaf_mean": {
              "type": "number"
            },
            "vmaf_per_kbps": {
              "type": "number"
            }
          }
        },
        "best_quality": {
          "type": ["object", "null"],
          "description": "Encoding with highest VMAF mean score",
          "properties": {
            "output_file": {
              "type": "string"
            },
            "parameters": {
              "type": "object"
            },
            "vmaf_mean": {
              "type": "number"
            },
            "bitrate_kbps": {
              "type": "number"
            }
          }
        },
        "total_analysis_time_seconds": {
          "type": "number",
          "description": "Total time spent analyzing all encodings"
        }
      }
    }
  },
  "additionalProperties": false
}
